{"version":3,"file":"jcall.umd.min.js","sources":["../src/jcall.js"],"sourcesContent":["function isObjectLiteral(obj) {\r\n  return (\r\n    typeof obj === \"object\" &&\r\n    obj !== null &&\r\n    Object.prototype.toString.call(obj) === \"[object Object]\"\r\n  );\r\n}\r\n\r\nconst METHODS = [\"put\", \"delete\", \"post\", \"get\", \"patch\"];\r\nconst local_noop = () => {}; // no operation fn\r\nconst FETCH_SUPPORT = typeof fetch === \"function\";\r\n\r\nclass FetchError extends Error {\r\n  constructor(message, status, statusText, response) {\r\n    super(message); // Pass the message to the parent (Error) constructor\r\n    this.name = this.constructor.name;\r\n    this.status = status || null;\r\n    this.statusText = statusText || null;\r\n    this.stack = new Error().stack;\r\n    this.response = response;\r\n  }\r\n}\r\n\r\nfunction getHeaders(object) {\r\n  const headers = {};\r\n  if (typeof object === \"string\") {\r\n    // Split headers into an object\r\n    object\r\n      .trim()\r\n      .split(/[\\r\\n]+/)\r\n      .forEach((line) => {\r\n        const parts = line.split(\": \");\r\n        const header = parts.shift();\r\n        const value = parts.join(\": \");\r\n        headers[header.toLowerCase()] = value;\r\n      });\r\n  } else if (object.entries) {\r\n    for (let [key, value] of object.entries()) {\r\n      headers[key] = value;\r\n    }\r\n  }\r\n  return headers;\r\n}\r\n\r\n/**\r\n * @typedef {Object} Headers\r\n * @property {String} cache Optionally identify caching mechanisme, must be one of these:\r\n * ```\r\n * const cacheValue = [\"no-cache\", \"no-store\", \"public\", \"private\", \"max-age=*\"]\r\n * ```\r\n * @property {String} accept Optionally identify the type of response you are expecting\r\n * @property {String} contentType Optionally define the contentType, if data provided not the same as contentType the program will adjust it value!\r\n * @property {String} referer the referer of the request\r\n * @property {String} origin the origin of the request\r\n * @property {String} lang the language of the request\r\n * @property {String} authorize the authorization token to be sent with the request\r\n * @property {Boolean} frame the frame options of the request\r\n * @property {String} cookie the cookie to be sent with the request\r\n * @property {Boolean} nosniff the nosniff options of the request\r\n * @property {Boolean} credentials the credentials to be sent with the request\r\n */\r\n\r\n/**\r\n * @typedef {Object} jcallMapControl\r\n * @property {String} type the request type, either `XHR` or `FETCH` depending on supported mechanism\r\n * @property {XMLHttpRequest} xhr the actual xmlHttpRequest used if any\r\n * @property {(msg: String) => jcallMapControl} abort abort the request\r\n * @property {(headers: Headers) => jcallMapControl} setHeaders Optionally add some headers\r\n * @property {function} progress progress callback\r\n * @property {function(): Promise} launch send the request\r\n * @readonly\r\n */\r\n\r\n/**\r\n * Send a synchronized request for a server backend, allowing you to create user-friendly interaction\r\n * with your different `data sources`.\r\n * @param {string} api Api could be either the url to be requested or composed one alongside the method `get:/people/names`\r\n * @param {Object} options Request different options, please read about jcall requests\r\n * @param {String} options.method The method used in the request one of <`POST`,`GET`,`PUT`,`DELETE`, `PATCH`>\r\n * @param {Object} [options.headers] Optionally provide some headers for the request, example:\r\n * ```\r\n * const headers = {\r\n * 'Content-Type': 'application/json',\r\n * 'Accept': 'application/json',\r\n * }\r\n * jcall({\r\n *  method: 'post',\r\n *  api: '/api',\r\n *  data: {name: 'john'},\r\n *  headers\r\n * })\r\n * ```\r\n * @param {true} [options.async] Optionally set the request to be asynchronous or not\r\n * @param {String} [options.contentType] Optionally provide the content type of the request\r\n * @param {Number} [options.timeout] Optionally limit the request execution time, you can catch timeout errors using:\r\n *  ```\r\n * jcall(..)\r\n * .then(..)\r\n * .catch((errType,error) => {\r\n * if(errType == 'timeout')\r\n * console.error('timeout error',error)\r\n * })\r\n * ```\r\n * @param {String} [options.csrf] the csrf token to be sent with the request\r\n * @param {Function} [options.progress] the progress of the request\r\n * @param {Function} [options.floaded] the function to be called when the request is loaded\r\n * @returns {control}\r\n */\r\nfunction jcall(api, options) {\r\n  if (!api)\r\n    throw new Error(\"An api/url must be defined to send an jcall request!\");\r\n\r\n  options = options || {};\r\n  let url = api;\r\n  let method = \"post\";\r\n  let timeout = options.timeout || null;\r\n  let credentials = options.credentials || false;\r\n  let csrf = options.csrf || jcall.csrf;\r\n  let useXHR = options.useXHR || false;\r\n\r\n  if (api.indexOf(\":\")) {\r\n    [method, url] = api.split(\":\");\r\n  }\r\n\r\n  // credentials are required to send cookies for csrf protections\r\n  // so let's activate them\r\n  if (csrf) {\r\n    credentials = true;\r\n  }\r\n\r\n  // auto create preventer\r\n  if (jcall.preventer === true) {\r\n    let div = document.createElement(\"div\");\r\n    // applying some style\r\n    div.style.backgroundColor = \"rgba(0,0,0,.2)\";\r\n    div.style.position = \"fixed\";\r\n    div.style.zIndex = \"10000\";\r\n    div.style.left = div.style.top = 0;\r\n    div.style.width = div.style.height = \"100%\";\r\n    div.style.display = \"none\";\r\n    div.open = function () {\r\n      this.style.display = \"inline\";\r\n    };\r\n    div.close = function () {\r\n      this.style.display = \"none\";\r\n    };\r\n    jcall.preventer = div;\r\n  }\r\n\r\n  // preparing the outline of the request\r\n  let abortController = new AbortController();\r\n  let request = {\r\n    api,\r\n    url,\r\n    method: method && METHODS.indexOf(method) != -1 ? method : \"post\",\r\n    credentials: typeof credentials == \"boolean\" ? credentials : false,\r\n    timeout: timeout\r\n      ? timeout < 10\r\n        ? timeout * 1000\r\n        : timeout < 100\r\n        ? timeout * 100\r\n        : timeout < 1000\r\n        ? timeout * 10\r\n        : timeout\r\n      : 0,\r\n    headers: {\r\n      signal: abortController.signal,\r\n    },\r\n    csrf,\r\n  };\r\n  if (jcall.authorization) request.headers[\"authorize\"] = jcall.authorization;\r\n\r\n  function endStatus(status, statusText, response, reject, resolve) {\r\n    switch (status) {\r\n      case 400:\r\n        reject(\r\n          new FetchError(\r\n            400 + \" - Bad Request: The server couldn't understand the request.\",\r\n            400,\r\n            statusText,\r\n            response\r\n          )\r\n        );\r\n        break;\r\n      case 401:\r\n        reject(\r\n          new FetchError(\r\n            401 +\r\n              \" - Unauthorized: Authentication is required, or the provided credentials are incorrect.\",\r\n            401,\r\n            statusText,\r\n            response\r\n          )\r\n        );\r\n        break;\r\n      case 403:\r\n        reject(\r\n          new FetchError(\r\n            403 +\r\n              \" - Forbidden: The server understood the request, but the user doesn't have permission to perform the action.\",\r\n            403,\r\n            statusText,\r\n            response\r\n          )\r\n        );\r\n        break;\r\n      case 404:\r\n        reject(\r\n          new FetchError(\r\n            404 +\r\n              \" - Not Found: The requested resource could not be found on the server.\",\r\n            404,\r\n            statusText,\r\n            response\r\n          )\r\n        );\r\n        break;\r\n      case 500:\r\n        reject(\r\n          new FetchError(\r\n            500 +\r\n              \" - Internal Server Error: The server encountered an unexpected condition.\",\r\n            500,\r\n            statusText,\r\n            response\r\n          )\r\n        );\r\n        break;\r\n      case 502:\r\n        reject(\r\n          new FetchError(\r\n            502 +\r\n              \" - Bad Gateway: The server, while acting as a gateway or proxy, received an invalid response from the upstream server.\",\r\n            502,\r\n            statusText,\r\n            response\r\n          )\r\n        );\r\n        break;\r\n      case 503:\r\n        reject(\r\n          new FetchError(\r\n            503 +\r\n              \" - Service Unavailable: The server is currently unavailable, often due to maintenance or overloading.\",\r\n            503,\r\n            statusText,\r\n            response\r\n          )\r\n        );\r\n    }\r\n  }\r\n\r\n  /**\r\n   * jcall request chaining mechanisme\r\n   * @type {jcallMapControl}\r\n   */\r\n  let control = {\r\n    type: useXHR === true ? \"XHR\" : FETCH_SUPPORT === true ? \"FETCH\" : \"XHR\",\r\n    progress: function () {},\r\n    setHeaders: function (headers) {\r\n      let res = {};\r\n\r\n      // setting some values\r\n      if (\r\n        headers.accept &&\r\n        [\r\n          \"application/json\",\r\n          \"application/xml\",\r\n          \"text/html\",\r\n          \"text/plain\",\r\n          \"*/*\",\r\n        ].indexOf(headers.accept) != -1\r\n      )\r\n        res.accept = headers.accept;\r\n      if (headers.cache) {\r\n        if (typeof headers.cache === \"boolean\")\r\n          if (this.type == \"XHR\")\r\n            res.cache = headers.cache == true ? \"public\" : \"no-cache\";\r\n          else res.cache = headers.cache == true ? \"force-cache\" : \"no-cache\";\r\n        else if (typeof headers.cache == \"string\")\r\n          if (\r\n            this.type == \"XHR\" &&\r\n            ([\"no-cache\", \"no-store\", \"public\", \"private\"].indexOf(\r\n              headers.cache\r\n            ) != -1 ||\r\n              headers.cache.indexOf(\"max-age=\") == 0)\r\n          )\r\n            res.cache = headers.cache;\r\n          else if (\r\n            this.type == \"FETCH\" &&\r\n            [\r\n              \"default\",\r\n              \"no-store\",\r\n              \"no-cache\",\r\n              \"reload\",\r\n              \"force-cache\",\r\n              \"only-if-cached\",\r\n            ].indexOf(headers.cache) != -1\r\n          )\r\n            res.cache = headers.cache;\r\n          else\r\n            console.warn(\r\n              \"You are using inproperiate values for ``cache`` attribute!\"\r\n            );\r\n      }\r\n\r\n      if (headers.cookie) res.cookie = headers.cookie;\r\n      if (headers.referer) res.referer = headers.referer;\r\n      if (headers.origin) res.origin = headers.origin;\r\n      if (headers.lang) res.lang = headers.lang;\r\n      if (headers.authorize) res.authorize = headers.authorize;\r\n      if (typeof headers.frame === \"boolean\")\r\n        res.frame = headers.frame === true ? \"SAMEORIGIN\" : \"DENY\";\r\n      if (headers.nosniff === true) res.nosniff = headers.nosniff;\r\n      if (headers.contentType) res.contentType = headers.contentType;\r\n      request.headers = res;\r\n      return this;\r\n    },\r\n    launch: function (data, dontUsePreventer) {\r\n      const { headers } = request;\r\n      let contentType = request.headers.contentType;\r\n      let result = {\r\n        result: null,\r\n        response: null,\r\n        headers: null,\r\n        contentType: null,\r\n      };\r\n\r\n      if (dontUsePreventer !== true && jcall.preventer) jcall.preventer.open();\r\n      return new Promise((res, rej) => {\r\n        let _this = this;\r\n        // deciding the way to send data\r\n        if (!(data instanceof FormData)) {\r\n          if (typeof data === \"string\") contentType = \"text/plain\";\r\n          else if (isObjectLiteral(data) === true) {\r\n            contentType = \"application/json\";\r\n            data = JSON.stringify(data);\r\n          } else {\r\n            // default is none to be set by the browser\r\n          }\r\n        }\r\n\r\n        if (this.type === \"XHR\") {\r\n          let perceed = true;\r\n          if (typeof jcall.before === \"function\")\r\n            perceed = jcall.before(request, data) === false ? false : true;\r\n          if (perceed === false) res(false); // silently returned\r\n\r\n          // ---------- SENDING XMLHttpRequest\r\n          let xhr = new XMLHttpRequest();\r\n          this.xhr = xhr;\r\n          xhr.open(request.method || \"post\", request.url);\r\n          xhr.setRequestHeader(\"X-Requested-With\", \"XMLHttpRequest\");\r\n\r\n          xhr.upload.onprogress = function (e) {\r\n            e.percent = (e.loaded / e.total) * 100;\r\n            if (typeof _this.progress == \"function\") _this.progress(e);\r\n          };\r\n          // some properties\r\n          if (typeof request.credentials == \"boolean\")\r\n            xhr.withCredentials = request.credentials;\r\n          xhr.timeout = request.timeout;\r\n          xhr.responseType = \"json\";\r\n\r\n          // some headers\r\n          if (request.csrf) xhr.setRequestHeader(\"X-CSRF-TOKEN\", request.csrf);\r\n          if (contentType) xhr.setRequestHeader(\"Content-Type\", contentType);\r\n          if (headers.accept) xhr.setRequestHeader(\"Accept\", headers.accept);\r\n          if (headers.cache)\r\n            xhr.setRequestHeader(\"Cache-Control\", headers.cache);\r\n          if (headers.cookie) xhr.setRequestHeader(\"Cookie\", headers.cookie);\r\n          if (headers.referer) xhr.setRequestHeader(\"Referer\", headers.referer);\r\n          if (headers.origin) xhr.setRequestHeader(\"Origin\", headers.origin);\r\n          if (headers.lang)\r\n            xhr.setRequestHeader(\"Accept-Language\", headers.lang);\r\n          if (headers.authorize)\r\n            xhr.setRequestHeader(\"Authorization\", headers.authorize);\r\n          if (headers.frame)\r\n            xhr.setRequestHeader(\"X-Frame-Options\", headers.frame);\r\n          if (headers.nosniff === true)\r\n            xhr.setRequestHeader(\"X-Content-Type-Options\", \"nosniff\");\r\n\r\n          xhr.onreadystatechange = function (e) {\r\n            if (this.readyState == 4) {\r\n              result.headers = getHeaders(this.getAllResponseHeaders());\r\n              if (jcall.preventer) jcall.preventer.close();\r\n              if (this.status == 200)\r\n                try {\r\n                  result.result = JSON.parse(this.response);\r\n                  result.response = this.response;\r\n                  res(result);\r\n                } catch (e) {\r\n                  rej(\"ServerSide Error\", this.responseText, this, e);\r\n                }\r\n              else {\r\n                endStatus(\r\n                  this.status,\r\n                  this.statusText,\r\n                  this.response,\r\n                  rej,\r\n                  res\r\n                );\r\n              }\r\n            }\r\n          };\r\n          xhr.onerror = function (e) {\r\n            if (jcall.preventer) jcall.preventer.close();\r\n            rej(\"error\", e, this);\r\n          };\r\n          xhr.ontimeout = function (e) {\r\n            if (jcall.preventer) jcall.preventer.close();\r\n            rej(\"timeout\", e, this);\r\n          };\r\n          xhr.onabort = function (e) {\r\n            if (jcall.preventer) jcall.preventer.close();\r\n            rej(\"abort\", e, this);\r\n          };\r\n          xhr.onprogress = function (e) {\r\n            e.percent = (e.loaded / e.total) * 100;\r\n            if (typeof _this.progress == \"function\") _this.progress(e);\r\n          };\r\n\r\n          xhr.send(data);\r\n        } else {\r\n          // ---------- FETCH request\r\n          let timeoutId;\r\n          if (request.timeout != 0 && request.timeout != 0) {\r\n            timeoutId = setTimeout(function () {\r\n              if (jcall.preventer) jcall.preventer.close();\r\n              _this.abort();\r\n            }, request.timeout);\r\n          }\r\n          request.body = data;\r\n          request.signal = abortController.signal;\r\n          request.credentials =\r\n            request.credentials === true ? \"include\" : \"omit\";\r\n          if (contentType) request.headers[\"Content-Type\"] = contentType;\r\n          if (request.headers.authorize)\r\n            request.headers[\"Authorization\"] = request.headers.authorize;\r\n          if (request.csrf) request.headers[\"X-CSRF-TOKEN\"] = request.csrf;\r\n\r\n          let perceed = true;\r\n          if (typeof jcall.before === \"function\")\r\n            perceed = jcall.before(request, data) === false ? false : true;\r\n          if (perceed === false) res(false); // silently returned\r\n\r\n          request.cache = fetch(request.url, request)\r\n            .then(async (response) => {\r\n              const { ok, status, statusText, type, headers } = response;\r\n              // clearing timeout\r\n              clearTimeout(timeoutId);\r\n              if (jcall.preventer) jcall.preventer.close();\r\n              if (!ok) {\r\n                endStatus(status, statusText, await response.json(), rej, res);\r\n                return;\r\n              }\r\n              let contentType = headers.get(\"Content-Type\").split(\";\")[0];\r\n              result[\"headers\"] = getHeaders(headers);\r\n              result[\"contentType\"] = contentType;\r\n              result[\"response\"] = response;\r\n\r\n              if (contentType.includes(\"application/json\")) {\r\n                result[\"result\"] = await response.json();\r\n                return res(result);\r\n              } else if (\r\n                contentType.includes(\"text/html\") ||\r\n                contentType.includes(\"text/plain\")\r\n              ) {\r\n                result[\"result\"] = await response.text();\r\n                return res(result);\r\n              } else if (\r\n                contentType.includes(\"image\") ||\r\n                contentType.includes(\"application/pdf\")\r\n              )\r\n                return response.blob();\r\n              else return response.arrayBuffer();\r\n            })\r\n            .then(async (data) => {\r\n              if (data instanceof Blob) {\r\n                const reader = new FileReader();\r\n                reader.readAsDataURL(blob);\r\n                reader.onloadend = () => {\r\n                  res(reader.result);\r\n                };\r\n              }\r\n            })\r\n            .catch((e) => {\r\n              if (jcall.preventer) jcall.preventer.close();\r\n              clearTimeout(timeoutId);\r\n              // internet connection or CORS error\r\n              if (e.name === \"AbortError\") return rej(\"timeout\");\r\n\r\n              rej(\"error\", e);\r\n            });\r\n        }\r\n      }).finally((res) => {\r\n        if (jcall.after) jcall.after(res);\r\n      });\r\n    },\r\n    abort: function (msg) {\r\n      if (this.request.type == \"XHR\") {\r\n        this.xhr.abort();\r\n      } else abortController.abort(msg);\r\n    },\r\n  };\r\n\r\n  // sealing so no modifications or adding any attributes is possible anymore\r\n  control = Object.seal(control);\r\n\r\n  return control;\r\n}\r\n\r\n/**\r\n * Cross-Site Request Forgery token used to avoid the danger of this attack.\r\n * If defined will be included within each request.\r\n * @type {String}\r\n */\r\njcall.csrf = null; // used in each jcall call if defined\r\n\r\n/**\r\n * Authorization token used to allow access for your API, when secured within\r\n * login system. Read more about it!\r\n * If defined will be included within each request.\r\n * @type {String}\r\n */\r\njcall.authorization = null; // used in each jcall call if defined\r\n\r\n/**\r\n * An after callback will be executed after all requests.\r\n * you can use this to automate csrf cycle configuration!\r\n * @method jcall\r\n * @param {Object} request\r\n * @param {Object} request.result\r\n * @param {Object} request.response\r\n * @param {Object} request.headers\r\n * @param {string} request.contentType\r\n */\r\njcall.after = local_noop;\r\n\r\n/**\r\n * A before callback will be executed just before any future request\r\n * you can use this to automate different tasks throughout your app\r\n * @param {Object} request\r\n * @param {string} request.api\r\n * @param {string} request.url\r\n * @param {string} request.method\r\n * @param {string} request.credentials\r\n * @param {number} request.timeout\r\n * @param {Object} request.headers\r\n * @param {string} request.csrf\r\n * @param {Object} data\r\n */\r\njcall.before = local_noop;\r\n\r\n/**\r\n * Used to prevent user interactions while request is being handled\r\n * server side. the prevent element must contain this functions\r\n *  - .open() : to open/display the preventer\r\n *  - .close() : to close/hide the preventer\r\n * @type {HTMLDivElement}\r\n */\r\njcall.preventer = null;\r\n\r\n/**\r\n * Powerfull function allows you to convert a regular submitable form into a jcall based\r\n * call, offering a customizable interface for maximum creativity and flex control!\r\n *\r\n * @param {HTMLFormElement} form the form to jcallify\r\n * @param {Object} options [Optional] options\r\n */\r\njcall.jcallify = function (form, options) {\r\n  let getAPI = null,\r\n    getDATA = null,\r\n    errorCb = local_noop,\r\n    successCb = local_noop;\r\n  let handle = {\r\n    /**\r\n     * Define a function that get a custom API/url(of the request) trick for more customized experience\r\n     * @param {() => (form: HTMLFormElement, api: String)} cb\r\n     */\r\n    api: function (cb) {\r\n      getAPI = cb;\r\n      return this;\r\n    },\r\n    /**\r\n     * Define a function that get a custom data object\r\n     * @param {() => (form: HTMLFormElement, data: FormData)} cb\r\n     */\r\n    data: function (cb) {\r\n      getDATA = cb;\r\n      return this;\r\n    },\r\n    /**\r\n     * Define a handler function\r\n     * @param {function} cb\r\n     */\r\n    success: function (cb) {\r\n      successCb = cb;\r\n      return this;\r\n    },\r\n    /**\r\n     * Define error handler function\r\n     * @param {function} cb\r\n     */\r\n    error: function (cb) {\r\n      errorCb = cb;\r\n      return this;\r\n    },\r\n  };\r\n  if (form instanceof HTMLFormElement) {\r\n    // let's make sure the form is setup well\r\n\r\n    form.addEventListener(\"submit\", function (e) {\r\n      e.preventDefault(); // preventing default behavior\r\n      let method = form.getAttribute(\"method\") || \"post\";\r\n\r\n      // preparing the API\r\n      let api = this.getAttribute(\"action\");\r\n      if (getAPI != null) api = getAPI(this, api);\r\n      if (!api)\r\n        throw new Error(\r\n          \"Bad setup!\\nplease include the action attribute in the form\"\r\n        );\r\n\r\n      // preparing the Data\r\n      let data = new FormData(this);\r\n      if (getDATA != null) data = getDATA(this, data);\r\n\r\n      jcall(api, {\r\n        method,\r\n      })\r\n        .launch(data)\r\n        .then((res) => {\r\n          successCb(res);\r\n        })\r\n        .catch((e) => errorCb(e));\r\n    });\r\n  }\r\n\r\n  return handle;\r\n};\r\n\r\n// globally exposed\r\nwindow.jcall = jcall;\r\nexport default jcall;\r\n"],"names":["METHODS","local_noop","FETCH_SUPPORT","fetch","FetchError","Error","constructor","message","status","statusText","response","super","this","name","stack","getHeaders","object","headers","trim","split","forEach","line","parts","header","shift","value","join","toLowerCase","entries","key","jcall","api","options","url","method","timeout","credentials","csrf","useXHR","indexOf","preventer","div","document","createElement","style","backgroundColor","position","zIndex","left","top","width","height","display","open","close","abortController","AbortController","request","signal","endStatus","reject","resolve","authorization","control","type","progress","setHeaders","res","accept","cache","console","warn","cookie","referer","origin","lang","authorize","frame","nosniff","contentType","launch","data","dontUsePreventer","result","Promise","rej","_this","obj","FormData","Object","prototype","toString","call","JSON","stringify","perceed","before","xhr","XMLHttpRequest","setRequestHeader","upload","onprogress","e","percent","loaded","total","withCredentials","responseType","onreadystatechange","readyState","getAllResponseHeaders","parse","responseText","onerror","ontimeout","onabort","send","timeoutId","setTimeout","abort","body","then","async","ok","clearTimeout","json","get","includes","text","blob","arrayBuffer","Blob","reader","FileReader","readAsDataURL","onloadend","catch","finally","after","msg","seal","jcallify","form","getAPI","getDATA","errorCb","successCb","handle","cb","success","error","HTMLFormElement","addEventListener","preventDefault","getAttribute","window"],"mappings":"sOAQA,MAAMA,EAAU,CAAC,MAAO,SAAU,OAAQ,MAAO,SAC3CC,EAAa,OACbC,EAAiC,mBAAVC,MAE7B,MAAMC,UAAmBC,MACvB,WAAAC,CAAYC,EAASC,EAAQC,EAAYC,GACvCC,MAAMJ,GACNK,KAAKC,KAAOD,KAAKN,YAAYO,KAC7BD,KAAKJ,OAASA,GAAU,KACxBI,KAAKH,WAAaA,GAAc,KAChCG,KAAKE,OAAQ,IAAIT,OAAQS,MACzBF,KAAKF,SAAWA,CACjB,EAGH,SAASK,EAAWC,GAClB,MAAMC,EAAU,CAAA,EAChB,GAAsB,iBAAXD,EAETA,EACGE,OACAC,MAAM,WACNC,SAASC,IACR,MAAMC,EAAQD,EAAKF,MAAM,MACnBI,EAASD,EAAME,QACfC,EAAQH,EAAMI,KAAK,MACzBT,EAAQM,EAAOI,eAAiBF,UAE/B,GAAIT,EAAOY,QAChB,IAAK,IAAKC,EAAKJ,KAAUT,EAAOY,UAC9BX,EAAQY,GAAOJ,EAGnB,OAAOR,CACT,CAkEA,SAASa,EAAMC,EAAKC,GAClB,IAAKD,EACH,MAAM,IAAI1B,MAAM,wDAGlB,IAAI4B,EAAMF,EACNG,EAAS,OACTC,GAHJH,EAAUA,GAAW,IAGCG,SAAW,KAC7BC,EAAcJ,EAAQI,cAAe,EACrCC,EAAOL,EAAQK,MAAQP,EAAMO,KAC7BC,EAASN,EAAQM,SAAU,EAa/B,GAXIP,EAAIQ,QAAQ,QACbL,EAAQD,GAAOF,EAAIZ,MAAM,MAKxBkB,IACFD,GAAc,IAIQ,IAApBN,EAAMU,UAAoB,CAC5B,IAAIC,EAAMC,SAASC,cAAc,OAEjCF,EAAIG,MAAMC,gBAAkB,iBAC5BJ,EAAIG,MAAME,SAAW,QACrBL,EAAIG,MAAMG,OAAS,QACnBN,EAAIG,MAAMI,KAAOP,EAAIG,MAAMK,IAAM,EACjCR,EAAIG,MAAMM,MAAQT,EAAIG,MAAMO,OAAS,OACrCV,EAAIG,MAAMQ,QAAU,OACpBX,EAAIY,KAAO,WACTzC,KAAKgC,MAAMQ,QAAU,QAC3B,EACIX,EAAIa,MAAQ,WACV1C,KAAKgC,MAAMQ,QAAU,MAC3B,EACItB,EAAMU,UAAYC,CACnB,CAGD,IAAIc,EAAkB,IAAIC,gBACtBC,EAAU,CACZ1B,MACAE,MACAC,OAAQA,IAAqC,GAA3BlC,EAAQuC,QAAQL,GAAgBA,EAAS,OAC3DE,YAAmC,kBAAfA,GAA2BA,EAC/CD,QAASA,EACLA,EAAU,GACE,IAAVA,EACAA,EAAU,IACA,IAAVA,EACAA,EAAU,IACA,GAAVA,EACAA,EACF,EACJlB,QAAS,CACPyC,OAAQH,EAAgBG,QAE1BrB,QAIF,SAASsB,EAAUnD,EAAQC,EAAYC,EAAUkD,EAAQC,GACvD,OAAQrD,GACN,KAAK,IACHoD,EACE,IAAIxD,EACF,iEACA,IACAK,EACAC,IAGJ,MACF,KAAK,IACHkD,EACE,IAAIxD,EACF,6FAEA,IACAK,EACAC,IAGJ,MACF,KAAK,IACHkD,EACE,IAAIxD,EACF,kHAEA,IACAK,EACAC,IAGJ,MACF,KAAK,IACHkD,EACE,IAAIxD,EACF,4EAEA,IACAK,EACAC,IAGJ,MACF,KAAK,IACHkD,EACE,IAAIxD,EACF,+EAEA,IACAK,EACAC,IAGJ,MACF,KAAK,IACHkD,EACE,IAAIxD,EACF,4HAEA,IACAK,EACAC,IAGJ,MACF,KAAK,IACHkD,EACE,IAAIxD,EACF,2GAEA,IACAK,EACAC,IAIT,CAhFGoB,EAAMgC,gBAAeL,EAAQxC,QAAmB,UAAIa,EAAMgC,eAsF9D,IAAIC,EAAU,CACZC,MAAiB,IAAX1B,EAAkB,OAA0B,IAAlBpC,EAAyB,QAAU,MACnE+D,SAAU,WAAc,EACxBC,WAAY,SAAUjD,GACpB,IAAIkD,EAAM,CAAA,EAwDV,OApDElD,EAAQmD,SAOuB,GAN/B,CACE,mBACA,kBACA,YACA,aACA,OACA7B,QAAQtB,EAAQmD,UAElBD,EAAIC,OAASnD,EAAQmD,QACnBnD,EAAQoD,QACmB,kBAAlBpD,EAAQoD,MACA,OAAbzD,KAAKoD,KACPG,EAAIE,MAAyB,GAAjBpD,EAAQoD,MAAgB,SAAW,WAC5CF,EAAIE,MAAyB,GAAjBpD,EAAQoD,MAAgB,cAAgB,WAC1B,iBAAjBpD,EAAQoD,QAEP,OAAbzD,KAAKoD,OAGE,GAFN,CAAC,WAAY,WAAY,SAAU,WAAWzB,QAC7CtB,EAAQoD,QAE6B,GAArCpD,EAAQoD,MAAM9B,QAAQ,YAIX,SAAb3B,KAAKoD,OAQyB,GAP9B,CACE,UACA,WACA,WACA,SACA,cACA,kBACAzB,QAAQtB,EAAQoD,OAElBF,EAAIE,MAAQpD,EAAQoD,MAEpBC,QAAQC,KACN,8DAfFJ,EAAIE,MAAQpD,EAAQoD,QAmBtBpD,EAAQuD,SAAQL,EAAIK,OAASvD,EAAQuD,QACrCvD,EAAQwD,UAASN,EAAIM,QAAUxD,EAAQwD,SACvCxD,EAAQyD,SAAQP,EAAIO,OAASzD,EAAQyD,QACrCzD,EAAQ0D,OAAMR,EAAIQ,KAAO1D,EAAQ0D,MACjC1D,EAAQ2D,YAAWT,EAAIS,UAAY3D,EAAQ2D,WAClB,kBAAlB3D,EAAQ4D,QACjBV,EAAIU,OAA0B,IAAlB5D,EAAQ4D,MAAiB,aAAe,SAC9B,IAApB5D,EAAQ6D,UAAkBX,EAAIW,QAAU7D,EAAQ6D,SAChD7D,EAAQ8D,cAAaZ,EAAIY,YAAc9D,EAAQ8D,aACnDtB,EAAQxC,QAAUkD,EACXvD,IACR,EACDoE,OAAQ,SAAUC,EAAMC,GACtB,MAAMjE,QAAEA,GAAYwC,EACpB,IAAIsB,EAActB,EAAQxC,QAAQ8D,YAC9BI,EAAS,CACXA,OAAQ,KACRzE,SAAU,KACVO,QAAS,KACT8D,YAAa,MAIf,OADyB,IAArBG,GAA6BpD,EAAMU,WAAWV,EAAMU,UAAUa,OAC3D,IAAI+B,SAAQ,CAACjB,EAAKkB,KACvB,IAAIC,EAAQ1E,KA1UpB,IAAyB2E,EAsVjB,GAVMN,aAAgBO,WACA,iBAATP,EAAmBF,EAAc,cACT,IA5U1B,iBAFMQ,EA8UUN,IA3UvB,OAARM,GACwC,oBAAxCE,OAAOC,UAAUC,SAASC,KAAKL,MA2UvBR,EAAc,mBACdE,EAAOY,KAAKC,UAAUb,KAMR,QAAdrE,KAAKoD,KAAgB,CACvB,IAAI+B,GAAU,EACc,mBAAjBjE,EAAMkE,SACfD,GAA0C,IAAhCjE,EAAMkE,OAAOvC,EAASwB,KAClB,IAAZc,GAAmB5B,GAAI,GAG3B,IAAI8B,EAAM,IAAIC,eACdtF,KAAKqF,IAAMA,EACXA,EAAI5C,KAAKI,EAAQvB,QAAU,OAAQuB,EAAQxB,KAC3CgE,EAAIE,iBAAiB,mBAAoB,kBAEzCF,EAAIG,OAAOC,WAAa,SAAUC,GAChCA,EAAEC,QAAWD,EAAEE,OAASF,EAAEG,MAAS,IACN,mBAAlBnB,EAAMrB,UAAwBqB,EAAMrB,SAASqC,EACpE,EAE4C,kBAAvB7C,EAAQrB,cACjB6D,EAAIS,gBAAkBjD,EAAQrB,aAChC6D,EAAI9D,QAAUsB,EAAQtB,QACtB8D,EAAIU,aAAe,OAGflD,EAAQpB,MAAM4D,EAAIE,iBAAiB,eAAgB1C,EAAQpB,MAC3D0C,GAAakB,EAAIE,iBAAiB,eAAgBpB,GAClD9D,EAAQmD,QAAQ6B,EAAIE,iBAAiB,SAAUlF,EAAQmD,QACvDnD,EAAQoD,OACV4B,EAAIE,iBAAiB,gBAAiBlF,EAAQoD,OAC5CpD,EAAQuD,QAAQyB,EAAIE,iBAAiB,SAAUlF,EAAQuD,QACvDvD,EAAQwD,SAASwB,EAAIE,iBAAiB,UAAWlF,EAAQwD,SACzDxD,EAAQyD,QAAQuB,EAAIE,iBAAiB,SAAUlF,EAAQyD,QACvDzD,EAAQ0D,MACVsB,EAAIE,iBAAiB,kBAAmBlF,EAAQ0D,MAC9C1D,EAAQ2D,WACVqB,EAAIE,iBAAiB,gBAAiBlF,EAAQ2D,WAC5C3D,EAAQ4D,OACVoB,EAAIE,iBAAiB,kBAAmBlF,EAAQ4D,QAC1B,IAApB5D,EAAQ6D,SACVmB,EAAIE,iBAAiB,yBAA0B,WAEjDF,EAAIW,mBAAqB,SAAUN,GACjC,GAAuB,GAAnB1F,KAAKiG,WAGP,GAFA1B,EAAOlE,QAAUF,EAAWH,KAAKkG,yBAC7BhF,EAAMU,WAAWV,EAAMU,UAAUc,QAClB,KAAf1C,KAAKJ,OACP,IACE2E,EAAOA,OAASU,KAAKkB,MAAMnG,KAAKF,UAChCyE,EAAOzE,SAAWE,KAAKF,SACvByD,EAAIgB,EACL,CAAC,MAAOmB,GACPjB,EAAI,mBAAoBzE,KAAKoG,aAAcpG,KAAM0F,EAClD,MAED3C,EACE/C,KAAKJ,OACLI,KAAKH,WACLG,KAAKF,SACL2E,EAKlB,EACUY,EAAIgB,QAAU,SAAUX,GAClBxE,EAAMU,WAAWV,EAAMU,UAAUc,QACrC+B,EAAI,QAASiB,EAAG1F,KAC5B,EACUqF,EAAIiB,UAAY,SAAUZ,GACpBxE,EAAMU,WAAWV,EAAMU,UAAUc,QACrC+B,EAAI,UAAWiB,EAAG1F,KAC9B,EACUqF,EAAIkB,QAAU,SAAUb,GAClBxE,EAAMU,WAAWV,EAAMU,UAAUc,QACrC+B,EAAI,QAASiB,EAAG1F,KAC5B,EACUqF,EAAII,WAAa,SAAUC,GACzBA,EAAEC,QAAWD,EAAEE,OAASF,EAAEG,MAAS,IACN,mBAAlBnB,EAAMrB,UAAwBqB,EAAMrB,SAASqC,EACpE,EAEUL,EAAImB,KAAKnC,EACnB,KAAe,CAEL,IAAIoC,EACmB,GAAnB5D,EAAQtB,SAAmC,GAAnBsB,EAAQtB,UAClCkF,EAAYC,YAAW,WACjBxF,EAAMU,WAAWV,EAAMU,UAAUc,QACrCgC,EAAMiC,OACpB,GAAe9D,EAAQtB,UAEbsB,EAAQ+D,KAAOvC,EACfxB,EAAQC,OAASH,EAAgBG,OACjCD,EAAQrB,aACkB,IAAxBqB,EAAQrB,YAAuB,UAAY,OACzC2C,IAAatB,EAAQxC,QAAQ,gBAAkB8D,GAC/CtB,EAAQxC,QAAQ2D,YAClBnB,EAAQxC,QAAuB,cAAIwC,EAAQxC,QAAQ2D,WACjDnB,EAAQpB,OAAMoB,EAAQxC,QAAQ,gBAAkBwC,EAAQpB,MAE5D,IAAI0D,GAAU,EACc,mBAAjBjE,EAAMkE,SACfD,GAA0C,IAAhCjE,EAAMkE,OAAOvC,EAASwB,KAClB,IAAZc,GAAmB5B,GAAI,GAE3BV,EAAQY,MAAQlE,MAAMsD,EAAQxB,IAAKwB,GAChCgE,MAAKC,MAAOhH,IACX,MAAMiH,GAAEA,EAAEnH,OAAEA,EAAMC,WAAEA,EAAUuD,KAAEA,EAAI/C,QAAEA,GAAYP,EAIlD,GAFAkH,aAAaP,GACTvF,EAAMU,WAAWV,EAAMU,UAAUc,SAChCqE,EAEH,YADAhE,EAAUnD,EAAQC,QAAkBC,EAASmH,OAAQxC,GAGvD,IAAIN,EAAc9D,EAAQ6G,IAAI,gBAAgB3G,MAAM,KAAK,GAKzD,OAJAgE,EAAgB,QAAIpE,EAAWE,GAC/BkE,EAAoB,YAAIJ,EACxBI,EAAiB,SAAIzE,EAEjBqE,EAAYgD,SAAS,qBACvB5C,EAAe,aAAUzE,EAASmH,OAC3B1D,EAAIgB,IAEXJ,EAAYgD,SAAS,cACrBhD,EAAYgD,SAAS,eAErB5C,EAAe,aAAUzE,EAASsH,OAC3B7D,EAAIgB,IAEXJ,EAAYgD,SAAS,UACrBhD,EAAYgD,SAAS,mBAEdrH,EAASuH,OACNvH,EAASwH,iBAEtBT,MAAKC,MAAOzC,IACX,GAAIA,aAAgBkD,KAAM,CACxB,MAAMC,EAAS,IAAIC,WACnBD,EAAOE,cAAcL,MACrBG,EAAOG,UAAY,KACjBpE,EAAIiE,EAAOjD,QAEd,KAEFqD,OAAOlC,IAIN,GAHIxE,EAAMU,WAAWV,EAAMU,UAAUc,QACrCsE,aAAaP,GAEE,eAAXf,EAAEzF,KAAuB,OAAOwE,EAAI,WAExCA,EAAI,QAASiB,KAElB,KACAmC,SAAStE,IACNrC,EAAM4G,OAAO5G,EAAM4G,MAAMvE,KAEhC,EACDoD,MAAO,SAAUoB,GACU,OAArB/H,KAAK6C,QAAQO,KACfpD,KAAKqF,IAAIsB,QACJhE,EAAgBgE,MAAMoB,EAC9B,GAMH,OAFA5E,EAAU0B,OAAOmD,KAAK7E,GAEfA,CACT,QAOAjC,EAAMO,KAAO,KAQbP,EAAMgC,cAAgB,KAYtBhC,EAAM4G,MAAQzI,EAed6B,EAAMkE,OAAS/F,EASf6B,EAAMU,UAAY,KASlBV,EAAM+G,SAAW,SAAUC,EAAM9G,GAC/B,IAAI+G,EAAS,KACXC,EAAU,KACVC,EAAUhJ,EACViJ,EAAYjJ,EACVkJ,EAAS,CAKXpH,IAAK,SAAUqH,GAEb,OADAL,EAASK,EACFxI,IACR,EAKDqE,KAAM,SAAUmE,GAEd,OADAJ,EAAUI,EACHxI,IACR,EAKDyI,QAAS,SAAUD,GAEjB,OADAF,EAAYE,EACLxI,IACR,EAKD0I,MAAO,SAAUF,GAEf,OADAH,EAAUG,EACHxI,IACR,GAgCH,OA9BIkI,aAAgBS,iBAGlBT,EAAKU,iBAAiB,UAAU,SAAUlD,GACxCA,EAAEmD,iBACF,IAAIvH,EAAS4G,EAAKY,aAAa,WAAa,OAGxC3H,EAAMnB,KAAK8I,aAAa,UAE5B,GADc,MAAVX,IAAgBhH,EAAMgH,EAAOnI,KAAMmB,KAClCA,EACH,MAAM,IAAI1B,MACR,+DAIJ,IAAI4E,EAAO,IAAIO,SAAS5E,MACT,MAAXoI,IAAiB/D,EAAO+D,EAAQpI,KAAMqE,IAE1CnD,EAAMC,EAAK,CACTG,WAEC8C,OAAOC,GACPwC,MAAMtD,IACL+E,EAAU/E,MAEXqE,OAAOlC,GAAM2C,EAAQ3C,IAC9B,IAGS6C,CACT,EAGAQ,OAAO7H,MAAQA"}