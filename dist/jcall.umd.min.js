!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).jcall=t()}(this,(function(){"use strict";const e=["put","delete","post","get","patch"],t=()=>{},r="function"==typeof fetch;class n extends Error{constructor(e,t,r,n){super(e),this.name=this.constructor.name,this.status=t||null,this.statusText=r||null,this.stack=(new Error).stack,this.response=n}}function o(e){const t={};if("string"==typeof e)e.trim().split(/[\r\n]+/).forEach((e=>{const r=e.split(": "),n=r.shift(),o=r.join(": ");t[n.toLowerCase()]=o}));else if(e.entries)for(let[r,n]of e.entries())t[r]=n;return t}function s(t,a){if(!t)throw new Error("An api/url must be defined to send an jcall request!");let i=((a=a||{}).method||"post").toLowerCase(),c=a.timeout||null,l=a.credentials||!1,u=a.csrf||s.csrf,h=a.useXHR||!1;if(u&&(l=!0),!0===s.preventer){let e=document.createElement("div");e.style.backgroundColor="rgba(0,0,0,.2)",e.style.position="fixed",e.style.zIndex="10000",e.style.left=e.style.top=0,e.style.width=e.style.height="100%",e.style.display="none",e.open=function(){this.style.display="inline"},e.close=function(){this.style.display="none"},s.preventer=e}let p=new AbortController,d={api:t,method:i&&-1!=e.indexOf(i)?i:"post",credentials:"boolean"==typeof l&&l,timeout:c?c<10?1e3*c:c<100?100*c:c<1e3?10*c:c:0,headers:{signal:p.signal},csrf:u};function f(e,t,r,o,s){switch(e){case 400:o(new n("400 - Bad Request: The server couldn't understand the request.",400,t,r));break;case 401:o(new n("401 - Unauthorized: Authentication is required, or the provided credentials are incorrect.",401,t,r));break;case 403:o(new n("403 - Forbidden: The server understood the request, but the user doesn't have permission to perform the action.",403,t,r));break;case 404:o(new n("404 - Not Found: The requested resource could not be found on the server.",404,t,r));break;case 500:o(new n("500 - Internal Server Error: The server encountered an unexpected condition.",500,t,r));break;case 502:o(new n("502 - Bad Gateway: The server, while acting as a gateway or proxy, received an invalid response from the upstream server.",502,t,r));break;case 503:o(new n("503 - Service Unavailable: The server is currently unavailable, often due to maintenance or overloading.",503,t,r))}}s.authorization&&(d.headers.authorize=s.authorization);let y={type:!0===h?"XHR":!0===r?"FETCH":"XHR",progress:function(){},setHeaders:function(e){let t={};return e.accept&&-1!=["application/json","application/xml","text/html","text/plain","*/*"].indexOf(e.accept)&&(t.accept=e.accept),e.cache&&("boolean"==typeof e.cache?"XHR"==this.type?t.cache=1==e.cache?"public":"no-cache":t.cache=1==e.cache?"force-cache":"no-cache":"string"==typeof e.cache&&("XHR"!=this.type||-1==["no-cache","no-store","public","private"].indexOf(e.cache)&&0!=e.cache.indexOf("max-age=")?"FETCH"==this.type&&-1!=["default","no-store","no-cache","reload","force-cache","only-if-cached"].indexOf(e.cache)?t.cache=e.cache:console.warn("You are using inproperiate values for ``cache`` attribute!"):t.cache=e.cache)),e.cookie&&(t.cookie=e.cookie),e.referer&&(t.referer=e.referer),e.origin&&(t.origin=e.origin),e.lang&&(t.lang=e.lang),e.authorize&&(t.authorize=e.authorize),"boolean"==typeof e.frame&&(t.frame=!0===e.frame?"SAMEORIGIN":"DENY"),!0===e.nosniff&&(t.nosniff=e.nosniff),e.contentType&&(t.contentType=e.contentType),d.headers=t,this},launch:function(e,t){const{headers:r}=d;let n=d.headers.contentType,a={result:null,response:null,headers:null,contentType:null};return!0!==t&&s.preventer&&s.preventer.open(),new Promise(((t,i)=>{let c=this;var l;if(e instanceof FormData||("string"==typeof e?n="text/plain":!0==("object"==typeof(l=e)&&null!==l&&"[object Object]"===Object.prototype.toString.call(l))&&(n="application/json",e=JSON.stringify(e))),"XHR"===this.type){let l=new XMLHttpRequest;this.xhr=l,l.open(d.method||"post",d.api),l.setRequestHeader("X-Requested-With","XMLHttpRequest"),l.upload.onprogress=function(e){e.percent=e.loaded/e.total*100,"function"==typeof c.progress&&c.progress(e)},"boolean"==typeof d.credentials&&(l.withCredentials=d.credentials),l.timeout=d.timeout,l.responseType="json",d.csrf&&l.setRequestHeader("X-CSRF-TOKEN",d.csrf),n&&l.setRequestHeader("Content-Type",n),r.accept&&l.setRequestHeader("Accept",r.accept),r.cache&&l.setRequestHeader("Cache-Control",r.cache),r.cookie&&l.setRequestHeader("Cookie",r.cookie),r.referer&&l.setRequestHeader("Referer",r.referer),r.origin&&l.setRequestHeader("Origin",r.origin),r.lang&&l.setRequestHeader("Accept-Language",r.lang),r.authorize&&l.setRequestHeader("Authorization",r.authorize),r.frame&&l.setRequestHeader("X-Frame-Options",r.frame),!0===r.nosniff&&l.setRequestHeader("X-Content-Type-Options","nosniff"),l.onreadystatechange=function(e){if(4==this.readyState)if(a.headers=o(this.getAllResponseHeaders()),s.preventer&&s.preventer.close(),200==this.status)try{a.result=JSON.parse(this.response),a.response=this.response,t(a)}catch(e){i("ServerSide Error",this.responseText,this,e)}else f(this.status,this.statusText,this.response,i)},l.onerror=function(e){s.preventer&&s.preventer.close(),i("error",e,this)},l.ontimeout=function(e){s.preventer&&s.preventer.close(),i("timeout",e,this)},l.onabort=function(e){s.preventer&&s.preventer.close(),i("abort",e,this)},l.onprogress=function(e){e.percent=e.loaded/e.total*100,"function"==typeof c.progress&&c.progress(e)},l.send(e)}else{let r;0!=d.timeout&&0!=d.timeout&&(r=setTimeout((function(){s.preventer&&s.preventer.close(),c.abort()}),d.timeout)),d.body=e,d.signal=p.signal,d.credentials=!0===d.credentials?"include":"omit",n&&(d.headers["Content-Type"]=n),d.headers.authorize&&(d.headers.Authorization=d.headers.authorize),d.csrf&&(d.headers["X-CSRF-TOKEN"]=d.csrf),d.cache=fetch(d.api,d).then((async e=>{const{ok:n,status:c,statusText:l,type:u,headers:h}=e;if(clearTimeout(r),s.preventer&&s.preventer.close(),!n)return void f(c,l,await e.json(),i);let p=h.get("Content-Type").split(";")[0];return a.headers=o(h),a.contentType=p,a.response=e,p.includes("application/json")?(a.result=await e.json(),t(a)):p.includes("text/html")||p.includes("text/plain")?(a.result=await e.text(),t(a)):p.includes("image")||p.includes("application/pdf")?e.blob():e.arrayBuffer()})).then((async e=>{if(e instanceof Blob){const e=new FileReader;e.readAsDataURL(blob),e.onloadend=()=>{t(e.result)}}})).catch((e=>{if(s.preventer&&s.preventer.close(),clearTimeout(r),"AbortError"===e.name)return i("timeout");i("error",e)}))}})).finally((e=>{s.after&&s.after(e)}))},abort:function(e){"XHR"==this.request.type?this.xhr.abort():p.abort(e)}};return y=Object.seal(y),y}return s.csrf=null,s.authorization=null,s.after=t,s.preventer=null,s.jcallify=function(e,r){let n=null,o=null,a=t,i=t,c={api:function(e){return n=e,this},data:function(e){return o=e,this},success:function(e){return i=e,this},error:function(e){return a=e,this}};return e instanceof HTMLFormElement&&e.addEventListener("submit",(function(t){t.preventDefault();let r=e.getAttribute("method")||"post",c=this.getAttribute("action");if(null!=n&&(c=n(this,c)),!c)throw new Error("Bad setup!\nplease include the action attribute in the form");let l=new FormData(this);null!=o&&(l=o(this,l)),s(c,{method:r}).launch(l).then((e=>{i(e)})).catch((e=>a(e)))})),c},window.jcall=s,s}));
//# sourceMappingURL=jcall.umd.min.js.map
